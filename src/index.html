<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      /* RE: 62.5% 
      See: https://www.sitepoint.com/understanding-and-using-rem-units-in-css */

      html {
        font-size: 62.5%;
      }

      body {
        font-family: Arial, Helvetica, sans-serif;
      }
    </style>
    <base href="/" />
    <link href="/style-px.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <form method="post" enctype="multipart/form-data" action="#">
      <input type="hidden" id="scheduled_for" name="scheduled_for" value="" />
      <div id="schedule-send-at"></div>
      <div id="hidden-value"></div>
    </form>
    <script>
      const populateTimes = () => {
        return [
          { val: "1:00", label: "1:00 AM" },
          { val: "2:00", label: "2:00 AM" },
          { val: "3:00", label: "3:00 AM" }
        ];
      };

      const getIsBlockedDay = (dayjs) => {
        return (day, state) => {
          const today = dayjs(new Date())
          if (today > day) {
            return true;
          }
          const blockedDays = [1, 3, 4]
          if (blockedDays.indexOf(day.$W) > -1) {
            return true;
          }
          return false
        }

      } 

      window.schedulerOptions = {
        init: dayjs => {
          const today = new Date()
          let firstDay = new Date()
          const oneDay = 24*60*60*1000
          const isBlockedDay = getIsBlockedDay(dayjs)
          while (isBlockedDay(dayjs(firstDay))) {
            firstDay = new Date(firstDay.getTime() + oneDay)
          }
          lastAvailableDate = dayjs(firstDay).add(3, "months");

          return {
            today: dayjs(today),
            firstAvailableDate: firstDay,
            lastAvailableDate: lastAvailableDate,
            date: dayjs(firstDay).format("YYYY-MM-DD"),
            time: "",
            time_values: populateTimes(),
            isBlockedDay: isBlockedDay,
            selected: [dayjs(firstDay).format("YYYY-MM-DD")],
            focusedDayNum: dayjs(firstDay).format("D"),
            updateMessage: "",
            _24hr: "en",
            errors: "",
            hiddenValueRef: document.getElementById("hidden-value")
          };
        },
      };
    </script>

    <script>
      setTimeout(function() {
        window.renderCalendar("schedule-send-at");
      }, 2000);

      setTimeout(function() {
        const myEvent = new CustomEvent("build", {
          detail: {
            type: "TIME_VALUES",
            payload: [
              { val: "1:00", label: "1:00 PM" },
              { val: "2:00", label: "2:00 PM" },
              { val: "3:00", label: "3:00 PM" },
              { val: "4:00", label: "4:00 PM" }
            ]
          }
        });
        window.dispatchEvent(myEvent);
      }, 10000);
    </script>
  </body>
</html>
